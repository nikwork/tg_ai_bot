# Telegram-бот для написания статьи на основани видео из Youtube

## Тема, описание задачи

"Нейро-обозреватель" - создание модели, которая на основании видео спортивного состязания создает аналитическую статью для журнала по данному мероприятию.

Конечный результат: ТГ-бот из 2 ассистентов:
Диалог с пользователем и сохранение ответов.
Написание статьи.
И дополнительной модели whisper для перевода аудио в текст.
Дополнительно предусмотрен функционал получения текста напрямую из субтитров youtube (если они доступны). Это позволит сократить расходы на транскрибацию.

## База и обработка базы(без конфиденциальных данных)

Отдельно собирать базу знаний для проекта не требуется. Используются саммаризированные данные из диалога с пользователем.

## Имплемпнтация

### Компоненты решения

Решение состоит из 2 основных частей:

- API на базе Fast-Api для работы с OpenAI (фактически прокси). Поддерживает всего 3 вызов (все тяжелые операци юыли вынесены в api):
  - "/post_open_ai_request" - запрос к модели OpenAI;
  - "/audio_from_video" - загрузка аудио из видео;
  - "/transcribe_with_whisper" - тяжелая опреция транскрибации видео по частям при помощи Whisper в OpenAI.
- ТГ-бот, отвечаюший за следующие компоненты решения:
  - общение с пользователем и оркестрация логики;
  - вычисление путей дял хранеия данных;
  - сохранение состояния ("context.user_data");
  - вызов API;
  - получение текста из видео при помощи готовых субтитров Youtubr (быстрая операция).

Эти части соответвенно расположены в каталогах:

- webservice/api
- webservice/telegram

соответвенно.

### Запуск решения

В каталге webservice/api запускаем командой:

```uvicorn main:app --port 5000```

В каталоге webservice/telegram запускаем командой:

```python async.py```

При этом должны быть определены следующие переменные среды:

- OPENAI_API_KEY
- TG_TOKEN

### Имлементация асистентов

Все промты собраны в одном месте: ```webservice/telegram/utils/prompts.py```.

#### Вопросы для кастомизации статьи

Опрос запускается командой ```/start_poll```. При этом, устанавливается состояние ```context.user_data["poll_started"] = True``` и кажое сообщение пользователя интерпретируется как ответ на вопрос, пока не выаолнятся условия выхода:

- все вопросы заданы;
- написано слово 'stop' в ответе.

После завешния опроса происходит саммаризация диалога функцией ```get_article_task```.

#### Написание статьи

Запускается командой ```/write_article``` и включет основные этапы:

- проверка достаточности информации (обязательно только наличие вылидной ссылки на видео);
- транскрибация (субтитры или whisper);
- написание статьи на основе опроса клиента или универсального задания (функция ```get_article```);
